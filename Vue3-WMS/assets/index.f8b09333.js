import{d as ae,b as le,u as ne,e as E,r as b,k as c,X as se,n as v,f as $,g as e,j as a,J as L,K as oe,i as t,q as N,x as u,t as i,R as P,S as q,m as re,L as ie,z as F,T as R,V as de}from"./index.3d7026b0.js";import{u as ue,g as ce,a as j,b as pe,r as me,c as fe}from"./index.b17757b6.js";import{_ as _e,M as be,t as ge}from"./common.b0e9a49e.js";const ve={class:"app-container"},he={key:1},we={class:"dialog-footer"},Ie=ae({__name:"index",setup(ye){const{t:l}=le(),O=ne(),{header:A,status:k,title:M}=ue(),U=(s,n)=>{switch(n){case"search":Object.assign(h,{...h,...s}),w();break;case"add":G();break;case"export":Q();break}},h=E({page:1,limit:20,orderID:void 0,timestamp:void 0,status:void 0}),T=b(null),D=b(0),x=b(!1),w=async()=>{x.value=!0;const s=await ce(h);T.value=s.data.items,D.value=s.data.total,x.value=!1},J=async s=>{const n=await j(s);Object.assign(d,n.data),y.value="detail",g.value=!0,F(()=>{I.value.clearValidate()})},H=async s=>{const n=await j(s);Object.assign(d,n.data),y.value="audit",g.value=!0,F(()=>{I.value.clearValidate()})},S=async s=>{const{id:n,reason:o}=d;(await pe({id:n,reason:o,status:s})).code===2e4&&(g.value=!1,R({title:"Success",message:l("tips.audit")+l("tips.success"),type:"success",duration:2e3}),w())},K=async s=>{(await me(s)).code===2e4&&(R({title:"Success",message:l("tips.delete")+l("tips.success"),type:"success",duration:2e3}),w())},z=b(!1),Q=ge(function(){z.value=!0,de(()=>import("./Export2Excel.27b48d37.js"),["./Export2Excel.27b48d37.js","./index.3d7026b0.js","./index.d2546d49.css"],import.meta.url).then(async s=>{const n=["orderID","correlationID","date","batch","origin","new","status","auditor","documenter","remark"],o=["orderID","correlationID","timestamp","batch","origin","new","status","auditor","documenter","remark"],{data:p}=await fe(),m=X(p,o);s.export_json_to_excel({header:n,data:m,filename:"transfer"}),z.value=!1})},5*1e3),X=(s,n)=>{if(!!s)return s.map(o=>n.map(p=>p==="timestamp"?P(o[p]):o[p]))},I=b(),y=b(""),g=b(!1),d=E({id:-1,orderID:"",correlationID:"",timestamp:"",documenter:"",status:-1,remark:"\u65E0",reason:"",production:[]}),G=()=>{O.push({path:"/transfer/create_update"})},W=s=>{O.push({path:"/transfer/create_update",query:{id:s}})};return w(),(s,n)=>{const o=c("el-table-column"),p=c("el-tag"),m=c("el-button"),B=c("el-table"),f=c("el-form-item"),_=c("el-col"),C=c("el-row"),Y=c("el-input"),Z=c("el-form"),ee=c("el-dialog"),te=se("loading");return v(),$("div",ve,[e(_e,{"config-data":a(A),onButtonClick:U},null,8,["config-data"]),L(e(be,{total:D.value,page:h.page,limit:h.limit,onPagination:w},{table:t(()=>[L((v(),N(B,{data:T.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"}},{default:t(()=>[e(o,{label:a(l)("transfer.orderID"),prop:"orderID","min-width":"160px",align:"center"},null,8,["label"]),e(o,{label:a(l)("transfer.date"),"min-width":"160px",align:"center"},{default:t(({row:r})=>[u(i(a(P)(r.timestamp,"{y}-{m}-{d}")),1)]),_:1},8,["label"]),e(o,{label:a(l)("transfer.batch"),"min-width":"160px",prop:"batch",align:"center"},null,8,["label"]),e(o,{label:a(l)("transfer.origin"),"min-width":"100px",align:"center",prop:"origin"},null,8,["label"]),e(o,{label:a(l)("transfer.new"),"min-width":"100px",align:"center",prop:"new"},null,8,["label"]),e(o,{label:a(l)("transfer.status"),"min-width":"120px",align:"center",prop:"status"},{default:t(({row:r})=>[e(p,{type:a(k)[r.status][1]},{default:t(()=>[u(i(a(k)[r.status][0]),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(o,{align:"center",label:a(l)("transfer.auditor"),"min-width":"90px",prop:"auditor"},null,8,["label"]),e(o,{label:a(l)("transfer.actions"),align:"center","min-width":"270px","class-name":"small-padding fixed-width"},{default:t(({row:r})=>[e(m,{type:"info",size:"small",onClick:V=>J(r.id)},{default:t(()=>[u(i(a(l)("button.detail")),1)]),_:2},1032,["onClick"]),e(m,{type:"primary",size:"small",onClick:V=>W(r.id)},{default:t(()=>[u(i(a(l)("button.edit")),1)]),_:2},1032,["onClick"]),r.status===0?(v(),N(m,{key:0,size:"small",type:"warning",onClick:V=>H(r.id)},{default:t(()=>[u(i(a(l)("button.audit")),1)]),_:2},1032,["onClick"])):q("",!0),e(m,{size:"small",type:"danger",onClick:V=>K(r.id)},{default:t(()=>[u(i(a(l)("button.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[te,x.value]])]),_:1},8,["total","page","limit"]),[[oe,D.value>0]]),e(ee,{title:a(M)[y.value],modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=r=>g.value=r),"align-center":"",width:"900px"},{footer:t(()=>[re("div",we,[y.value==="audit"?(v(),$(ie,{key:0},[e(m,{type:"success",onClick:n[1]||(n[1]=r=>S(1))},{default:t(()=>[u(i(a(l)("button.pass")),1)]),_:1}),e(m,{type:"danger",onClick:n[2]||(n[2]=r=>S(2))},{default:t(()=>[u(i(a(l)("button.noPass")),1)]),_:1})],64)):q("",!0),e(m,{onClick:n[3]||(n[3]=r=>g.value=!1)},{default:t(()=>[u(i(a(l)("button.cancel")),1)]),_:1})])]),default:t(()=>[e(Z,{ref_key:"dataForm",ref:I,model:d,"label-position":"left"},{default:t(()=>[e(C,{gutter:20},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.orderID")+":",prop:"orderID"},{default:t(()=>[u(i(d.orderID),1)]),_:1},8,["label"])]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.documenter")+":",prop:"documenter"},{default:t(()=>[u(i(d.documenter),1)]),_:1},8,["label"])]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.status")+":",prop:"status"},{default:t(()=>[e(p,{type:a(k)[d.status][1]},{default:t(()=>[u(i(a(k)[d.status][0]),1)]),_:1},8,["type"])]),_:1},8,["label"])]),_:1})]),_:1}),e(C,{gutter:20},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.correlationID")+":",prop:"correlationID"},{default:t(()=>[u(i(d.correlationID),1)]),_:1},8,["label"])]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.date")+":",prop:"timestamp"},{default:t(()=>[u(i(d.timestamp),1)]),_:1},8,["label"])]),_:1}),e(_,{span:8},{default:t(()=>[e(f,{label:a(l)("transfer.remark")+":",prop:"remark"},{default:t(()=>[u(i(d.remark),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(_,{span:20},{default:t(()=>[e(f,{label:a(l)("transfer.reason")+":",prop:"reason"},{default:t(()=>[y.value==="audit"?(v(),N(Y,{key:0,modelValue:d.reason,"onUpdate:modelValue":n[0]||(n[0]=r=>d.reason=r),rows:3,type:"textarea"},null,8,["modelValue"])):(v(),$("span",he,i(d.reason),1))]),_:1},8,["label"])]),_:1})]),_:1}),e(B,{data:d.production,border:"",fit:"","highlight-current-row":"","header-cell-class-name":"table_header",style:{width:"100%"}},{default:t(()=>[e(o,{"min-width":"100px",label:a(l)("transfer.productionID"),align:"center",prop:"productionID"},null,8,["label"]),e(o,{"min-width":"100px",label:a(l)("transfer.productionName"),align:"center",prop:"productionName"},null,8,["label"]),e(o,{align:"center",label:a(l)("transfer.quantity"),prop:"quantity","min-width":"95"},null,8,["label"]),e(o,{"class-name":"status-col",label:a(l)("transfer.unit"),prop:"unit","min-width":"80"},null,8,["label"])]),_:1},8,["data"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Ie as default};
