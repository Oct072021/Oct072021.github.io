import{d as ee,b as te,w as ae,r as y,e as H,k as u,n as k,f as A,J as _e,K as be,g as e,i as t,j as a,m as le,t as s,R as se,x as n,q as L,S as J,T as oe,E as S,u as fe,a as ve,L as X,M as ye,U as ge,z as Y,V as he,_ as ke}from"./index.a0fe722d.js";import{u as ne,g as we,r as xe,a as Z,b as De,c as Ce}from"./index.a9131ba0.js";import{M as Ve,_ as Ie,t as $e}from"./common.cfed7fdf.js";const Te=ee({__name:"TabPane",props:{area:{default:"area-1"},searchList:{default:()=>({status:void 0,type:void 0,orderID:void 0})}},emits:["create","handleUpdate","toDetail","handleAudit"],setup(K,{expose:r,emit:$}){const{t:i}=te(),T=K,w=$;ae(()=>T.searchList,p=>{Object.assign(_,p),D()},{deep:!0});const{type:z,status:N}=ne(),P=y(null),_=H({page:1,limit:10,type:void 0,status:void 0,orderID:void 0,area:T.area}),O=y(!1),x=y(0),D=async p=>{p&&Object.assign(_,p),O.value=!0;const I=await we(_);P.value=I.data.items,O.value=!1,x.value=I.data.total,w("create")};D();const R=p=>{w("handleUpdate",p)},B=async p=>{(await xe(p)).code===2e4&&(oe({title:"Success",message:S.global.t("tips.delete")+S.global.t("tips.success"),type:"success",duration:2e3}),D())},q=p=>{w("toDetail",p)},E=p=>{w("handleAudit",p)};return r({getList:D}),(p,I)=>{const b=u("el-table-column"),C=u("el-tag"),f=u("el-button"),d=u("el-table");return k(),A("div",null,[_e(e(Ve,{total:x.value,page:_.page,limit:_.limit,onPagination:D},{table:t(()=>[e(d,{data:P.value,border:"",fit:"","highlight-current-row":"",style:{width:"100%"},draggable:""},{default:t(()=>[e(b,{"min-width":"130px",label:a(i)("orders.orderID"),prop:"orderID",align:"center"},null,8,["label"]),e(b,{"min-width":"130px",label:a(i)("orders.title"),align:"center",prop:"title"},null,8,["label"]),e(b,{"min-width":"120px",align:"center",label:a(i)("orders.date")},{default:t(({row:m})=>[le("span",null,s(a(se)(m.timestamp,"{y}-{m}-{d}")),1)]),_:1},8,["label"]),e(b,{"class-name":"status-col",label:a(i)("orders.type"),"min-width":"120"},{default:t(({row:m})=>[n(s(a(z)[m.type]),1)]),_:1},8,["label"]),e(b,{"class-name":"status-col",label:a(i)("orders.client"),prop:"client","min-width":"110"},null,8,["label"]),e(b,{"class-name":"status-col",label:a(i)("orders.documenter"),prop:"documenter","min-width":"120"},null,8,["label"]),e(b,{"class-name":"status-col",label:a(i)("orders.status"),"min-width":"120"},{default:t(({row:m})=>[e(C,{type:a(N)[m.status][1]},{default:t(()=>[n(s(a(N)[m.status][0]),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(b,{"class-name":"status-col",label:a(i)("orders.auditor"),"min-width":"110",prop:"auditor"},null,8,["label"]),e(b,{label:a(i)("orders.actions"),align:"center","min-width":"270","class-name":"small-padding fixed-width"},{default:t(({row:m})=>[e(f,{type:"info",size:"small",onClick:U=>q(m.id)},{default:t(()=>[n(s(a(i)("button.detail")),1)]),_:2},1032,["onClick"]),e(f,{type:"primary",size:"small",onClick:U=>R(m.id)},{default:t(()=>[n(s(a(i)("button.edit")),1)]),_:2},1032,["onClick"]),m.status===0?(k(),L(f,{key:0,size:"small",type:"warning",onClick:U=>E(m.id)},{default:t(()=>[n(s(a(i)("button.audit")),1)]),_:2},1032,["onClick"])):J("",!0),e(f,{size:"small",type:"danger",onClick:U=>B(m.id)},{default:t(()=>[n(s(a(i)("button.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["total","page","limit"]),[[be,x.value>0]])])}}}),Oe={class:"tab-container"},Ue={key:1},Ae={class:"dialog-footer"},Le=ee({__name:"index",setup(K){const{t:r}=te(),$=fe(),i=ve(),{type:T,status:w,title:z,area:N,header:P}=ne(),_=y("area-1");ae(_,c=>{$.push(`${i.path}?tab=${c}`)});const O=i.query.tab;O&&(_.value=O);const x=H({type:void 0,orderID:void 0,status:void 0}),D=(c,l)=>{switch(l){case"search":Object.assign(x,{...x,...c});break;case"add":m();break;case"export":p();break}},R=y(0),B=()=>{R.value++},q=y(null),E=y(!1),p=$e(async function(){E.value=!0;const c=await Ce(_.value);q.value=c.data,he(()=>import("./Export2Excel.4f109762.js"),["./Export2Excel.4f109762.js","./index.a0fe722d.js","./index.d2546d49.css"],import.meta.url).then(l=>{const v=["orderID","title","data","type","client","documenter","status","auditor"],M=I(["orderID","title","timestamp","type","client","documenter","status","auditor"]);l.export_json_to_excel({header:v,data:M,filename:`outbound-list-${_.value}`}),E.value=!1})},5*1e3),I=c=>q.value.map(l=>c.map(v=>{switch(v){case"timestamp":return se(l[v],"{y}-{m}-{d}");case"type":return T.value[l[v]];case"status":return w.value[l[v]][0];default:return l[v]}})),b=y(),C=y(""),f=y(!1),d=H({id:-1,orderID:"",status:-1,area:"",type:-1,timestamp:"",client:"",documenter:"",number:void 0,remark:"",contact:"",reason:"",production:[],auditor:""}),m=()=>{$.push({path:"/order/outbound/create_update"})},U=c=>{$.push({path:"/order/outbound/create_update",query:{id:c}})},re=async c=>{const l=await Z(c);Object.assign(d,l.data),C.value="detail",f.value=!0,Y(()=>{b.value.clearValidate()})},Q=y(),de=async c=>{const l=await Z(c);Object.assign(d,l.data),C.value="audit",f.value=!0,Y(()=>{b.value.clearValidate()})},G=async(c,l)=>{(await De({detail:c,status:l})).code===2e4&&(f.value=!1,oe({title:"Success",message:S.global.t("tips.audit")+S.global.t("tips.success"),type:"success",duration:2e3}),Q.value[0].getList())};return(c,l)=>{const v=u("el-tag"),W=u("el-alert"),M=u("el-tab-pane"),ue=u("el-tabs"),g=u("el-form-item"),h=u("el-col"),F=u("el-row"),ie=u("el-input"),V=u("el-table-column"),ce=u("el-table"),pe=u("el-form"),j=u("el-button"),me=u("el-dialog");return k(),A("div",Oe,[e(v,null,{default:t(()=>[n("mounted times : "+s(R.value),1)]),_:1}),e(W,{closable:!1,style:{width:"200px",display:"inline-block","vertical-align":"middle","margin-left":"30px"},title:"Tab with keep-alive",type:"success"}),e(Ie,{"config-data":a(P),onButtonClick:D},null,8,["config-data"]),e(ue,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=o=>_.value=o),style:{"margin-top":"15px"},type:"border-card"},{default:t(()=>[(k(!0),A(X,null,ye(a(N),o=>(k(),L(M,{key:o.key,label:o.label,name:o.key},{default:t(()=>[(k(),L(ge,null,[_.value==o.key?(k(),L(Te,{ref_for:!0,ref_key:"TabPaneRef",ref:Q,key:o.key,area:o.key,"search-list":x,onCreate:B,onHandleUpdate:U,onToDetail:re,onHandleAudit:de},null,8,["area","search-list"])):J("",!0)],1024))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),e(me,{title:a(z)[C.value],modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=o=>f.value=o),"align-center":"",width:"900px"},{footer:t(()=>[le("div",Ae,[C.value==="audit"?(k(),A(X,{key:0},[e(j,{type:"success",onClick:l[2]||(l[2]=o=>G(d,1))},{default:t(()=>[n(s(a(r)("button.pass")),1)]),_:1}),e(j,{type:"danger",onClick:l[3]||(l[3]=o=>G(d,2))},{default:t(()=>[n(s(a(r)("button.noPass")),1)]),_:1})],64)):J("",!0),e(j,{onClick:l[4]||(l[4]=o=>f.value=!1)},{default:t(()=>[n(s(a(r)("button.cancel")),1)]),_:1})])]),default:t(()=>[e(pe,{ref_key:"dataForm",ref:b,model:d,"label-position":"left"},{default:t(()=>[e(F,{gutter:20},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.orderID")+":",prop:"orderID"},{default:t(()=>[n(s(d.orderID),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.type")+":",prop:"type"},{default:t(()=>[n(s(a(T)[d.type]),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.status")+":",prop:"status"},{default:t(()=>[e(v,{type:a(w)[d.status][1]},{default:t(()=>[n(s(a(w)[d.status][0]),1)]),_:1},8,["type"])]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{gutter:20},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.client")+":",prop:"client"},{default:t(()=>[n(s(d.client),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.contact")+":",prop:"contact"},{default:t(()=>[n(s(d.contact),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.number")+":",prop:"number"},{default:t(()=>[n(s(d.number),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(F,{gutter:20},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.documenter")+":",prop:"documenter"},{default:t(()=>[n(s(d.documenter),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.date")+":",prop:"timestamp"},{default:t(()=>[n(s(d.timestamp),1)]),_:1},8,["label"])]),_:1}),e(h,{span:8},{default:t(()=>[e(g,{label:a(r)("orders.remark")+":",prop:"remark"},{default:t(()=>[n(s(d.remark),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(h,{span:20},{default:t(()=>[e(g,{label:a(r)("orders.reason")+":",prop:"reason"},{default:t(()=>[C.value==="audit"?(k(),L(ie,{key:0,modelValue:d.reason,"onUpdate:modelValue":l[1]||(l[1]=o=>d.reason=o),rows:3,type:"textarea"},null,8,["modelValue"])):(k(),A("span",Ue,s(d.reason),1))]),_:1},8,["label"])]),_:1})]),_:1}),e(ce,{data:d.production,border:"",fit:"","highlight-current-row":"","header-cell-class-name":"table_header",style:{width:"100%"}},{default:t(()=>[e(V,{"min-width":"100px",label:a(r)("orders.productionID"),align:"center",prop:"productionID"},null,8,["label"]),e(V,{"min-width":"100px",label:a(r)("orders.productionName"),align:"center",prop:"productionName"},null,8,["label"]),e(V,{align:"center",label:a(r)("orders.specs"),"min-width":"95"},{default:t(({row:o})=>[n(s(`${o.specs1} \xD7 ${o.specs2}`),1)]),_:1},8,["label"]),e(V,{"class-name":"status-col",label:a(r)("orders.price"),prop:"price","min-width":"80"},null,8,["label"]),e(V,{"class-name":"status-col",label:a(r)("orders.quantity"),"min-width":"80"},{default:t(({row:o})=>[n(s(o.quantity+" /\u4EF6"),1)]),_:1},8,["label"]),e(V,{"class-name":"status-col",label:a(r)("orders.total"),"min-width":"90"},{default:t(({row:o})=>[n(s((o.price*o.quantity).toFixed(2)),1)]),_:1},8,["label"]),e(V,{"class-name":"status-col",label:a(r)("area"),"min-width":"105"},{default:t(()=>[n(s(d.area),1)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});const qe=ke(Le,[["__scopeId","data-v-24395f9c"]]);export{qe as default};
