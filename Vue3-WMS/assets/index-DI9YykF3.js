import{d as x,r as i,z as h,o as T,Y as E,x as N,w as O,g as S,i as p,j as D,J as j,K as q,L as F,E as J,_ as K,s as P,t as w,T as U,n as Y,l as A,k as G}from"./index-Dpah9Y0-.js";const Q=["id"],W=x({__name:"index",props:{listData:{default:()=>[]},estimatedItemSize:{},bufferScale:{default:1},height:{default:"80vh"}},setup(_){const l=_,v=i(),m=i(),y=i(),c=i([]),k=i(0),s=i(0),g=i(0),t=i([]),L=h(()=>l.listData.map((e,a)=>({_index:`_${a}`,item:e}))),b=h(()=>Math.ceil(k.value/l.estimatedItemSize)),I=h(()=>Math.min(s.value,l.bufferScale*b.value)),V=h(()=>Math.min(l.listData.length-g.value,l.bufferScale*b.value)),C=h(()=>{let e=s.value-I.value,a=g.value+V.value;return L.value.slice(e,a)}),z=()=>{t.value=l.listData.map((e,a)=>({index:a,height:l.estimatedItemSize,top:a*l.estimatedItemSize,bottom:(a+1)*l.estimatedItemSize}))},$=(e=0)=>B(t.value,e),B=(e,a)=>{let o=0,d=e.length-1,n=null;for(;o<=d;){let r=Math.floor((o+d)/2),u=e[r].bottom;if(u===a)return r+1;u<a?o=r+1:u>a&&((n===null||n>r)&&(n=r),d=r-1)}return n},H=()=>{c.value.forEach(a=>{let d=a.getBoundingClientRect().height,n=+a.id.slice(1),u=t.value[n].height-d;if(u){t.value[n].bottom=t.value[n].bottom-u,t.value[n].height=d;for(let f=n+1;f<t.value.length;f++)t.value[f].top=t.value[f-1].bottom,t.value[f].bottom=t.value[f].bottom-u}})},R=()=>{let e;if(s.value>=1){let a=t.value[s.value].top-(t.value[s.value-I.value]?t.value[s.value-I.value].top:0);e=t.value[s.value-1].bottom-a}else e=0;y.value.style.transform=`translate3d(0,${e}px,0)`},M=()=>{let e=v.value.scrollTop;s.value=$(e),g.value=s.value+b.value,R()};return T(()=>{k.value=v.value.clientHeight,s.value=0,g.value=s.value+b.value,z()}),E(()=>{N(()=>{if(!c.value||!c.value.length)return;H();let e=t.value[t.value.length-1].bottom;m.value.style.height=e+"px",R()})}),O(()=>l.listData,z),(e,a)=>(p(),S("div",{ref_key:"listRef",ref:v,style:J({height:e.height}),class:"infinite-list-container",onScroll:M},[D("div",{ref_key:"phantomRef",ref:m,class:"infinite-list-phantom"},null,512),D("div",{ref_key:"contentRef",ref:y,class:"infinite-list"},[(p(!0),S(j,null,q(C.value,o=>(p(),S("div",{class:"infinite-list-item",ref_for:!0,ref_key:"items",ref:c,id:o._index,key:o._index},[F(e.$slots,"default",{ref_for:!0,ref:"slot",item:o.item},void 0,!0)],8,Q))),128))],512)],36))}}),X=K(W,[["__scopeId","data-v-269fd177"]]),Z={style:{color:"red"}},ee=x({__name:"Item",props:{item:{default:()=>({})}},setup(_){return(l,v)=>(p(),S("p",null,[D("span",Z,w(l.item.id),1),P(" "+w(l.item.value),1)]))}});function te(){return U.postRequest("/test/textList")}async function ae(){return(await te()).data}const le=x({name:"VirtualList"}),ne=x({...le,setup(_){const l=i([]);return(async()=>{const m=await ae();l.value=m})(),(m,y)=>(p(),Y(X,{listData:l.value,estimatedItemSize:100},{default:A(c=>[G(ee,{item:c.item},null,8,["item"])]),_:1},8,["listData"]))}});export{ne as default};
